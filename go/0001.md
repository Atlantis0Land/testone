# ูุธุงู ุฅุฏุงุฑุฉ ูุดุงุฑูุน ุงูุชุญูู ุงูุฑููู - ุงูุฏููู ุงููุนูุงุฑู ุงูุดุงูู

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู](#ูุธุฑุฉ-ุนุงูุฉ-ุนูู-ุงููุธุงู)
2. [ุงููุนูุงุฑูุฉ ุงูุนุงูุฉ](#ุงููุนูุงุฑูุฉ-ุงูุนุงูุฉ)
3. [ูุงุนุฏุฉ ุงูุจูุงูุงุช](#ูุงุนุฏุฉ-ุงูุจูุงูุงุช)
4. [ูุธุงู Redis ูุงูุชุฎุฒูู ุงููุคูุช](#ูุธุงู-redis-ูุงูุชุฎุฒูู-ุงููุคูุช)
5. [ุฎุฏูุงุช ุงูุฅุดุนุงุฑุงุช](#ุฎุฏูุงุช-ุงูุฅุดุนุงุฑุงุช)
6. [ูุธุงู ุงูุฃูุงู](#ูุธุงู-ุงูุฃูุงู)
7. [ุฅุฏุงุฑุฉ ุงููููุงุช](#ุฅุฏุงุฑุฉ-ุงููููุงุช)
8. [ุงููุดุฑ ูุงูุชุดุบูู](#ุงููุดุฑ-ูุงูุชุดุบูู)
9. [ูุฎุทุทุงุช ุงููุธุงู](#ูุฎุทุทุงุช-ุงููุธุงู)

---

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู

### ุงููุฏู ุงูุฃุณุงุณู
ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ูุดุงุฑูุน ุงูุชุญูู ุงูุฑููู ูู ูุญุงูุธุฉ ุงูุธุงูุฑุฉุ ูุฏุนู ุฏูุฑุฉ ุญูุงุฉ ุงููุดุฑูุน ุงููุงููุฉ ูู ุงูุชุฎุทูุท ุฅูู ุงูุฅุบูุงู ูุน ุงูุชุชุจุน ุงููุงูู ูุงูุฅุฏุงุฑู.

### ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ
- **Backend**: Django 5.x + Python 3.11+
- **Database**: PostgreSQL 15+ (UUID Primary Keys)
- **Cache & Queue**: Redis 7+
- **Frontend**: Tailwind CSS + Alpine.js + Chart.js
- **Background Jobs**: Celery + Redis
- **Deployment**: Docker + Gunicorn + Nginx

---

## ุงููุนูุงุฑูุฉ ุงูุนุงูุฉ

### ุชุทุจููุงุช Django ุงูุฃุณุงุณูุฉ

#### ๐ **accounts** - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุฃูุงู
```
accounts/
โโโ models.py          # UserProfile, LoginAttempt
โโโ views.py           # ุงูุชุณุฌููุ ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ
โโโ middleware.py      # InactivityMiddleware
โโโ services.py        # ุฎุฏูุงุช ุงูุฃูุงู
```

**ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:**
- ูุตุงุฏูุฉ ุซูุงุฆูุฉ ุนุจุฑ WhatsApp/SMS
- ุชุชุจุน ูุญุงููุงุช ุงูุฏุฎูู ูุงูู IP
- ุฅุฏุงุฑุฉ ุฌูุณุงุช ุงูุนูู
- ูููุฉ ุณุฑ ูููุตูุฉ ููุจูุงุจุฉ ุงูุขููุฉ

#### ๐ **projects** - ุฅุฏุงุฑุฉ ุฏูุฑุฉ ุญูุงุฉ ุงููุดุงุฑูุน
```
projects/
โโโ models.py          # Project, Payment, ProjectDocument
โโโ views.py           # Kanban, Timeline, Reports
โโโ stages.py          # 5 ูุฑุงุญู ุฃุณุงุณูุฉ
โโโ calculations.py    # ุญุณุงุจุงุช ุงูุชูุฏู ุงููุงูู
```

**ูุฑุงุญู ุงููุดุฑูุน ุงูุฎูุณุฉ:**
1. **ุงูุชุฎุทูุท** (Planning) - ุชุญุฏูุฏ ุงููุทุงู ูุงููุชุทูุจุงุช
2. **ุงูููุงูุตุฉ** (Tender) - ุนูููุฉ ุงูุชุฑุณูุฉ
3. **ุงูุชุนุงูุฏ** (Contract) - ุชูููุน ุงูุนููุฏ
4. **ุงูุชูููุฐ** (Execution) - ุชูููุฐ ุงููุดุฑูุน
5. **ุงูุฅุบูุงู** (Closure) - ุชุณููู ูุฅุบูุงู ุงููุดุฑูุน

#### ๐ข **companies** - ุฅุฏุงุฑุฉ ุงูููุงูููู
```
companies/
โโโ models.py          # Company, CompanyDocument
โโโ views.py           # ูููุงุช ุงูุดุฑูุงุช ูุงูุชูููู
โโโ types.py           # ูุญููุ ุฏูููุ ุญููููุ ูุฑุฏู
```

#### ๐ฐ **budget** - ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ
```
budget/
โโโ models.py          # Budget, BudgetAllocation, BudgetTransaction
โโโ views.py           # ุชุฎุตูุต ุงูููุฒุงููุงุช ูุชุชุจุน ุงูุฅููุงู
โโโ calculations.py    # ุญุณุงุจุงุช ูุงููุฉ ุฏูููุฉ (Decimal)
โโโ reports.py         # ุชูุงุฑูุฑ ูุงููุฉ
```

#### ๐ **reports** - ุฅูุดุงุก ุงูุชูุงุฑูุฑ
```
reports/
โโโ models.py          # PrintTemplate, ReportGeneration
โโโ generators/        # ูููุฏุงุช PDF/Excel/Word
โโโ templates/         # ููุงูุจ ุงูุชูุงุฑูุฑ
โโโ schedulers.py      # ุชูุงุฑูุฑ ูุฌุฏููุฉ
```

#### ๐ฑ **notifications** - ุงูุฅุดุนุงุฑุงุช ูุชุนุฏุฏุฉ ุงููููุงุช
```
notifications/
โโโ models.py          # NotificationTemplate, Notification
โโโ services.py        # WhatsAppService, SMSService, EmailService
โโโ channels/          # ูููุงุช ุงูุฅุฑุณุงู ุงููุฎุชููุฉ
โโโ templates/         # ููุงูุจ ุงูุฑุณุงุฆู
```

#### โ๏ธ **settings** - ุชูููู ุงููุธุงู
```
settings/
โโโ models.py          # APIConfiguration, SystemSettings
โโโ services.py        # SettingsManager
โโโ views.py           # ูุงุฌูุงุช ุงูุฅุนุฏุงุฏุงุช
```

---

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุชุตููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```mermaid
erDiagram
    User ||--o{ UserProfile : has
    User ||--o{ Project : creates
    Project ||--o{ Payment : has
    Project ||--o{ ProjectDocument : contains
    Project }o--|| Company : assigned_to
    Project }o--o{ Budget : allocated_from
    Budget ||--o{ BudgetAllocation : has
    Budget ||--o{ BudgetTransaction : tracks
    User ||--o{ Notification : receives
    APIConfiguration ||--o{ Notification : sends_via
```

### ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ

#### **Projects**
- `id` (UUID) - ูุนุฑู ูุฑูุฏ
- `commitment_number` (String) - ุฑูู ุงูุงูุชุฒุงู
- `name` (String) - ุงุณู ุงููุดุฑูุน
- `stage` (Choice) - ุงููุฑุญูุฉ ุงูุญุงููุฉ
- `total_amount` (Decimal) - ุงููููุฉ ุงูุฅุฌูุงููุฉ
- `technical_progress` (Decimal) - ูุณุจุฉ ุงูุชูุฏู ุงูููู
- `company` (FK) - ุงูุดุฑูุฉ ุงููููุฐุฉ
- `created_at`, `updated_at` - ุทูุงุจุน ุฒูููุฉ

#### **Budget**
- `id` (UUID) - ูุนุฑู ูุฑูุฏ
- `name` (String) - ุงุณู ุงูููุฒุงููุฉ
- `year` (Integer) - ุงูุณูุฉ ุงููุงููุฉ
- `total_amount` (Decimal) - ุงููุจูุบ ุงูุฅุฌูุงูู
- `allocated_amount` (Decimal) - ุงููุจูุบ ุงููุฎุตุต
- `spent_amount` (Decimal) - ุงููุจูุบ ุงููุตุฑูู

#### **APIConfiguration**
- `id` (UUID) - ูุนุฑู ูุฑูุฏ
- `service_type` (Choice) - ููุน ุงูุฎุฏูุฉ (whatsapp, sms, email)
- `name` (String) - ุงุณู ุงูุชูููู
- `api_key` (String) - ููุชุงุญ API
- `api_url` (URL) - ุฑุงุจุท API
- `is_active` (Boolean) - ุญุงูุฉ ุงูุชูุนูู
- `additional_settings` (JSON) - ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ

---

## ูุธุงู Redis ูุงูุชุฎุฒูู ุงููุคูุช

### ุงุณุชุฎุฏุงูุงุช Redis ูู ุงููุธุงู

#### 1. **Session Storage**
```python
# settings.py
SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
SESSION_CACHE_ALIAS = 'default'
```

#### 2. **Celery Task Queue**
```python
# celery.py
CELERY_BROKER_URL = 'redis://redis:6379/0'
CELERY_RESULT_BACKEND = 'redis://redis:6379/0'
```

#### 3. **Application Cache**
```python
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://redis:6379/1',
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        }
    }
}
```

### ููุงู Celery ุงููุฌุฏููุฉ

#### ุงูููุงู ุงูููููุฉ
- **backup_database**: ูุณุฎ ุงุญุชูุงุทู ูููู ููุงุนุฏุฉ ุงูุจูุงูุงุช
- **send_payment_reminders**: ุชุฐููุฑ ุจุงููุฏููุนุงุช ุงููุณุชุญูุฉ
- **cleanup_temp_files**: ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ

#### ุงูููุงู ุงูุฃุณุจูุนูุฉ
- **generate_weekly_reports**: ุชูุงุฑูุฑ ุฃุณุจูุนูุฉ ูููุฏุฑุงุก
- **system_health_check**: ูุญุต ุตุญุฉ ุงููุธุงู

#### ุงูููุงู ุงูุดูุฑูุฉ
- **archive_old_notifications**: ุฃุฑุดูุฉ ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ
- **budget_analysis_report**: ุชุญููู ุงูููุฒุงููุงุช ุงูุดูุฑู

---

## ุฎุฏูุงุช ุงูุฅุดุนุงุฑุงุช

### ุจููุฉ ูุธุงู ุงูุฅุดุนุงุฑุงุช

#### **WhatsApp Service**
```python
class WhatsAppService:
    @staticmethod
    def get_api_config():
        """ุงูุญุตูู ุนูู ุชูููู WhatsApp ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช"""
        from settings.services import SettingsManager
        return SettingsManager.get_api_config('whatsapp')
    
    @staticmethod
    def send_verification_code(phone, code):
        """ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู"""
        config = WhatsAppService.get_api_config()
        # ููุทู ุงูุฅุฑุณุงู...
```

#### **ููุงูุจ ุงูุฑุณุงุฆู**
- **ุฑูุฒ ุงูุชุญูู**: `template_verification`
- **ุฅุดุนุงุฑุงุช ุนุงูุฉ**: `template_notification`
- **ุชุฐููุฑ ุงููุฏููุนุงุช**: `template_payment_reminder`
- **ุชุญุฏูุซ ุญุงูุฉ ุงููุดุฑูุน**: `template_project_update`

#### **ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ**
```python
# ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุน Exponential Backoff
retry_delays = [1, 2, 4, 8, 16]  # ุซูุงูู
max_retries = 3
```

---

## ูุธุงู ุงูุฃูุงู

### ูุณุชููุงุช ุงูุฃูุงู

#### **1. ุงููุตุงุฏูุฉ ูุงูุชุฑุฎูุต**
- Django's built-in authentication
- Two-Factor Authentication via WhatsApp
- Role-based permissions
- CSRF protection

#### **2. ุญูุงูุฉ ุงูุจูุงูุงุช**
- UUID primary keys (ุชุฌูุจ enumeration attacks)
- Hashed passwords (Django's PBKDF2)
- Encrypted gateway passwords
- Input validation and sanitization

#### **3. ูุฑุงูุจุฉ ุงูุฃูุงู**
```python
class LoginAttempt(models.Model):
    ip_address = models.GenericIPAddressField()
    username = models.CharField(max_length=255)
    success = models.BooleanField(default=False)
    timestamp = models.DateTimeField(auto_now_add=True)
    user_agent = models.TextField()
```

#### **4. ุงูุจูุงุจุฉ ุงูุขููุฉ ูุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช**
- ูููุฉ ุณุฑ ูููุตูุฉ ููุจูุงุจุฉ ุฃู ุงุณุชุฎุฏุงู ูููุฉ ุณุฑ ุงูุญุณุงุจ
- ุชุดููุฑ ูุงูู ูููููุงุช ุงููุฑููุนุฉ
- ุชุชุจุน ุฌููุน ุนูููุงุช ุงูุงุณุชูุฑุงุฏ

---

## ุฅุฏุงุฑุฉ ุงููููุงุช

### ุฃููุงุน ุงููููุงุช ุงููุฏุนููุฉ

#### **ูุซุงุฆู ุงููุดุงุฑูุน**
- PDF, DOC, DOCX
- XLS, XLSX
- Images (PNG, JPG, JPEG)
- Maximum size: 10MB

#### **ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ**
- Database dumps (PostgreSQL)
- Media files backup
- Configuration backup

#### **ุงูุชูุงุฑูุฑ ุงููููุดุฃุฉ**
- PDF reports
- Excel exports
- Word documents

### ุชุฎุฒูู ุงููููุงุช
```python
# settings.py
MEDIA_ROOT = '/opt/app/media/'
MEDIA_URL = '/media/'

# File upload security
FILE_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024  # 10MB
FILE_UPLOAD_PERMISSIONS = 0o644
```

---

## ุงููุดุฑ ูุงูุชุดุบูู

### Docker Architecture
```yaml
# docker-compose.yml
services:
  app:
    build: .
    ports:
      - "8000:8000"
    depends_on:
      - db
      - redis
    
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: dtp_db
      POSTGRES_USER: dtp_user
      POSTGRES_PASSWORD: secure_password
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
```

### Production Setup
```bash
# Gunicorn configuration
bind = "0.0.0.0:8000"
workers = 4
worker_class = "gevent"
worker_connections = 1000
max_requests = 1000
max_requests_jitter = 100
```

### Health Monitoring
```python
# Health check endpoints
/health/              # Basic health check
/health/db/           # Database connectivity
/health/redis/        # Redis connectivity
/health/celery/       # Celery workers status
```

---

## ูุฎุทุทุงุช ุงููุธุงู

### 1. ุชุฏูู ุฏูุฑุฉ ุญูุงุฉ ุงููุดุฑูุน
```
ุงูุชุฎุทูุท โ ุงูููุงูุตุฉ โ ุงูุชุนุงูุฏ โ ุงูุชูููุฐ โ ุงูุฅุบูุงู
    โ         โ         โ         โ         โ
ุฅุนุฏุงุฏ     ุชุฑุณูุฉ    ุชูููุน    ุชูููุฐ     ุชุณููู
ุงููุชุทูุจุงุช   ุงูููุงูุตุฉ   ุงูุนูุฏ     ุงูุนูู     ููุงุฆู
```

### 2. ูุธุงู ุงูุฅุดุนุงุฑุงุช
```
Event Trigger โ Notification Service โ Channel Router โ Delivery
     โ               โ                    โ             โ
ูุดุฑูุน ุฌุฏูุฏ     ูุงูุจ ุงูุฑุณุงูุฉ         WhatsApp        ุงููุณุชุฎุฏู
ุชุญุฏูุซ ุญุงูุฉ     ูุนุงูุฌุฉ ุงูุจูุงูุงุช        SMS           ุงูุฅุฏุงุฑุฉ
ููุนุฏ ุฏูุน      ุชุญุฏูุฏ ุงููุณุชูุจู        Email         ุงูููุงูู
```

### 3. ุชุฏูู ุงูุจูุงูุงุช ุงููุงููุฉ
```
Budget Creation โ Project Allocation โ Payment Processing โ Financial Reporting
       โ                โ                     โ                    โ
ุฅูุดุงุก ุงูููุฒุงููุฉ   ุชุฎุตูุต ูููุดุงุฑูุน      ูุนุงูุฌุฉ ุงููุฏููุนุงุช      ุชูุงุฑูุฑ ูุงููุฉ
ุชุญุฏูุฏ ุงููุจูุบ     ุชุญุฏูุฏ ุงููุณุจ         ุชุชุจุน ุงููุฑุงุญู        ุชุญููู ุงูุฅููุงู
```

### 4. ูุนูุงุฑูุฉ ุงูุฃูุงู
```
User Login โ 2FA Check โ Session Management โ Activity Logging
    โ           โ            โ                  โ
ูุญุต ุจูุงูุงุช    ุฑูุฒ ุงูุชุญูู    ุฅุฏุงุฑุฉ ุงูุฌูุณุฉ       ุชุณุฌูู ุงูุนูููุงุช
ุงูุฏุฎูู       WhatsApp      ูููุฉ ุงูุชูุงุก       ูุฑุงูุจุฉ ุงูุฃูุงู
```

---

## ุงููุชุทูุจุงุช ุงูุชุดุบูููุฉ

### ุงูุญุฏ ุงูุฃุฏูู ูููุธุงู
- **CPU**: 2 cores
- **RAM**: 4GB
- **Storage**: 50GB SSD
- **Network**: 10Mbps

### ุงูุฅูุชุงุฌ ุงูููุตู ุจู
- **CPU**: 4+ cores
- **RAM**: 8GB+
- **Storage**: 100GB+ SSD
- **Network**: 100Mbps+

### ูุณุฎ ุงุญุชูุงุทูุฉ
- **ููููุฉ**: ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููููุงุช ุงูุญูููุฉ
- **ุฃุณุจูุนูุฉ**: ูุณุฎุฉ ูุงููุฉ ูููุธุงู
- **ุดูุฑูุฉ**: ุฃุฑุดูุฉ ุทูููุฉ ุงููุฏู

---

## ุฅุนุฏุงุฏุงุช ุงููุทูุฑูู

### ุงูุจูุฆุฉ ุงููุญููุฉ
```bash
# ุชุซุจูุช ุงููุชุทูุจุงุช
pip install -r requirements.txt

# ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
python manage.py migrate

# ุชุดุบูู ุงูุฎุงุฏู
python manage.py runserver
```

### ูุชุบูุฑุงุช ุงูุจูุฆุฉ
```env
DEBUG=True
SECRET_KEY=your-secret-key
DATABASE_URL=postgresql://user:pass@localhost/db
REDIS_URL=redis://localhost:6379/0
```

### ุฃุฏูุงุช ุงูุชุทููุฑ
- **Testing**: Django TestCase + Coverage
- **Linting**: flake8 + black
- **Documentation**: Sphinx + mkdocs
- **Monitoring**: Django Debug Toolbar

---

*ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ูู: {{ current_date }}*
*ุงูุฅุตุฏุงุฑ: 2.0.0*
*ููุฏุนู ุงูุชููู: admin@dtp.gov.om*
